<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบส่งประวัติย่อและภาพประทับใจ</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=K2D:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- SweetAlert2 -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.27/dist/sweetalert2.min.css" rel="stylesheet">
    
    <!-- DataTables -->
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            font-family: 'K2D', sans-serif;
        }
        
        :root {
            --primary-green: #4CAF50;
            --light-green: #E8F5E8;
            --dark-green: #2E7D32;
            --border-green: #81C784;
        }
        
        body {
            background: linear-gradient(135deg, var(--light-green) 0%, #ffffff 100%);
            min-height: 100vh;
        }
        
        .header-section {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo-img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
        }
        
        .main-container {
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
        
        .nav-tabs .nav-link {
            border: 2px solid var(--border-green);
            color: var(--dark-green);
            font-weight: 500;
            margin-right: 0.5rem;
            border-radius: 10px 10px 0 0;
        }
        
        .nav-tabs .nav-link.active {
            background-color: var(--primary-green);
            border-color: var(--primary-green);
            color: white;
        }
        
        .tab-content {
            background: white;
            border: 2px solid var(--border-green);
            border-radius: 0 15px 15px 15px;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.1);
        }
        
        .form-control, .form-select {
            border: 2px solid var(--border-green);
            border-radius: 10px;
            padding: 0.75rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-green);
            box-shadow: 0 0 0 0.2rem rgba(76, 175, 80, 0.25);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            border: none;
            border-radius: 10px;
            padding: 0.75rem 2rem;
            font-weight: 500;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .card {
            border: 2px solid var(--border-green);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.1);
        }
        
        .card-header {
            background: var(--light-green);
            border-bottom: 2px solid var(--border-green);
            font-weight: 600;
            color: var(--dark-green);
        }
        
        .file-upload-area {
            border: 3px dashed var(--border-green);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            background: var(--light-green);
            transition: all 0.3s ease;
        }
        
        .file-upload-area:hover {
            border-color: var(--primary-green);
            background: rgba(76, 175, 80, 0.1);
        }
        
        .progress {
            height: 25px;
            border-radius: 15px;
            background-color: var(--light-green);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, var(--primary-green) 0%, var(--dark-green) 100%);
            border-radius: 15px;
        }
        
        .stats-card {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
        }
        
        .preview-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 10px;
            border: 2px solid var(--border-green);
            margin: 0.25rem;
            transition: transform 0.3s ease;
        }
        
        .preview-image:hover {
            transform: scale(1.5);
            z-index: 1000;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .thumbnail-container {
            position: relative;
            display: inline-block;
        }
        
        .thumbnail-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 2px 5px;
            font-size: 10px;
            text-align: center;
            border-radius: 0 0 8px 8px;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--light-green);
            border-top: 5px solid var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .modal-content {
            border-radius: 15px;
            border: 2px solid var(--border-green);
        }
        
        .modal-header {
            background: var(--light-green);
            border-bottom: 2px solid var(--border-green);
        }
        
        @media (max-width: 768px) {
            .header-section {
                padding: 1rem 0;
            }
            
            .logo-img {
                width: 40px;
                height: 40px;
            }
            
            .tab-content {
                padding: 1rem;
            }
            
            .stats-number {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="text-center">
            <div class="spinner"></div>
            <p class="mt-3 text-success fw-bold">กำลังประมวลผล...</p>
        </div>
    </div>

    <!-- PDPA Modal -->
    <div class="modal fade" id="pdpaModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-shield-alt me-2"></i>นโยบายความเป็นส่วนตัว (PDPA)</h5>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgP7650FTCSeNQU8DBnHv7w0lL7CxVLmv_vLJ4tE9vcPbILI9KNeTqAUnmPg6ELY-qyt5BLKSAuaQILMr6gyYiWqF8HToyRnYiks86ESHapld6XUGvp0wGfuGYyvra18zjhZN1afCwQ66ZvMxxaoS3ACz0zbe6d07GuYNWd7xFGPZZjI5tTLSiyOkifsqAh/s1600/sesapylogo.png" alt="Logo" class="logo-img">
                        <h4 class="mt-3 text-success">ยินดีต้อนรับสู่ระบบส่งประวัติย่อและภาพประทับใจ</h4>
                    </div>
                    
                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle me-2"></i>วัตถุประสงค์ของระบบ</h6>
                        <p>ระบบนี้จัดทำขึ้นเพื่อรวบรวมประวัติย่อและภาพประทับใจของข้าราชการครูและบุคลากรทางการศึกษา สังกัด สพม.พะเยา</p>
                    </div>
                    
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-database me-2"></i>การเก็บรวบรวมข้อมูล</h6>
                        <ul class="mb-0">
                            <li>ข้อมูลส่วนบุคคล (ชื่อ-สกุล, ตำแหน่ง, โรงเรียน)</li>
                            <li>ข้อมูลติดต่อ (อีเมล, เบอร์โทรศัพท์)</li>
                            <li>ไฟล์ประวัติย่อและภาพประทับใจ</li>
                        </ul>
                    </div>
                    
                    <div class="alert alert-success">
                        <h6><i class="fas fa-lock me-2"></i>การคุ้มครองข้อมูล</h6>
                        <p>ข้อมูลของท่านจะถูกเก็บรักษาอย่างปลอดภัยและใช้เพื่อวัตถุประสงค์ทางการศึกษาเท่านั้น</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="window.close()">
                        <i class="fas fa-times me-2"></i>ยกเลิก
                    </button>
                    <button type="button" class="btn btn-primary" onclick="acceptPDPA()">
                        <i class="fas fa-check me-2"></i>ยินยอมเข้าระบบ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <div class="header-section">
        <div class="container">
            <div class="logo-container justify-content-center">
                <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgP7650FTCSeNQU8DBnHv7w0lL7CxVLmv_vLJ4tE9vcPbILI9KNeTqAUnmPg6ELY-qyt5BLKSAuaQILMr6gyYiWqF8HToyRnYiks86ESHapld6XUGvp0wGfuGYyvra18zjhZN1afCwQ66ZvMxxaoS3ACz0zbe6d07GuYNWd7xFGPZZjI5tTLSiyOkifsqAh/s1600/sesapylogo.png" alt="Logo" class="logo-img">
                <div>
                    <h2 class="mb-0">ระบบส่งประวัติย่อและภาพประทับใจ</h2>
                    <p class="mb-0 opacity-75">สำนักงานเขตพื้นที่การศึกษามัธยมศึกษาพะเยา</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container main-container">
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="upload-tab" data-bs-toggle="tab" data-bs-target="#upload" type="button" role="tab">
                    <i class="fas fa-upload me-2"></i>เพิ่มข้อมูล
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">
                    <i class="fas fa-chart-bar me-2"></i>สถิติและ Dashboard
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="manage-tab" data-bs-toggle="tab" data-bs-target="#manage" type="button" role="tab">
                    <i class="fas fa-cogs me-2"></i>จัดการข้อมูล
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="mainTabContent">
            <!-- Tab 1: Upload Form -->
            <div class="tab-pane fade show active" id="upload" role="tabpanel">
                <form id="uploadForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-calendar me-2"></i>วันที่ส่ง</label>
                            <input type="date" class="form-control" id="submitDate" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-user me-2"></i>ชื่อ-สกุล</label>
                            <input type="text" class="form-control" id="fullName" placeholder="กรอกชื่อ-สกุล" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-briefcase me-2"></i>ตำแหน่ง</label>
                            <select class="form-select" id="position" required>
                                <option value="">เลือกตำแหน่ง</option>
                                <option value="ครู">ครู</option>
                                <option value="รองผู้อำนวยการ">รองผู้อำนวยการ</option>
                                <option value="ผู้อำนวยการ">ผู้อำนวยการ</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-star me-2"></i>วิทยฐานะ</label>
                            <select class="form-select" id="academicLevel" required>
                                <option value="">เลือกวิทยฐานะ</option>
                                <option value="ชำนาญการ">ชำนาญการ</option>
                                <option value="ชำนาญการพิเศษ">ชำนาญการพิเศษ</option>
                                <option value="เชี่ยวชาญ">เชี่ยวชาญ</option>
                                <option value="เชี่ยวชาญพิเศษ">เชี่ยวชาญพิเศษ</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-school me-2"></i>โรงเรียน</label>
                            <select class="form-select" id="school" required>
                                <option value="">เลือกโรงเรียน</option>
                                <option value="โรงเรียนพะเยาพิทยาคม">โรงเรียนพะเยาพิทยาคม</option>
<option value="โรงเรียนฟากกว๊านวิทยาคม">โรงเรียนฟากกว๊านวิทยาคม</option>
<option value="โรงเรียนพะเยาประสาธน์วิทย์">โรงเรียนพะเยาประสาธน์วิทย์</option>
<option value="โรงเรียนจุนวิทยาคม">โรงเรียนจุนวิทยาคม</option>
<option value="โรงเรียนพญาลอวิทยาคม">โรงเรียนพญาลอวิทยาคม</option>
<option value="โรงเรียนเชียงคำวิทยาคม">โรงเรียนเชียงคำวิทยาคม</option>
<option value="โรงเรียนฝายกวางวิทยาคม">โรงเรียนฝายกวางวิทยาคม</option>
<option value="โรงเรียนเชียงม่วนวิทยาคม">โรงเรียนเชียงม่วนวิทยาคม</option>
<option value="โรงเรียนดอกคำใต้วิทยาคม">โรงเรียนดอกคำใต้วิทยาคม</option>
<option value="โรงเรียนถ้ำปินวิทยาคม">โรงเรียนถ้ำปินวิทยาคม</option>
<option value="โรงเรียนงำเมืองวิทยาคม">โรงเรียนงำเมืองวิทยาคม</option>
<option value="โรงเรียนปงรัชดาภิเษก">โรงเรียนปงรัชดาภิเษก</option>
<option value="โรงเรียนปงพัฒนาวิทยาคม">โรงเรียนปงพัฒนาวิทยาคม</option>
<option value="โรงเรียนขุนควรวิทยาคม">โรงเรียนขุนควรวิทยาคม</option>
<option value="โรงเรียนแม่ใจวิทยาคม">โรงเรียนแม่ใจวิทยาคม</option>
<option value="โรงเรียนภูซางวิทยาคม">โรงเรียนภูซางวิทยาคม</option>
<option value="โรงเรียนดงเจนวิทยาคม">โรงเรียนดงเจนวิทยาคม</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-envelope me-2"></i>อีเมล</label>
                            <input type="email" class="form-control" id="email" placeholder="example@email.com" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-phone me-2"></i>เบอร์โทรศัพท์</label>
                            <input type="tel" class="form-control" id="phone" placeholder="0812345678" pattern="[0-9]{10}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-check-circle me-2"></i>สถานะการตรวจสอบ</label>
                            <select class="form-select" id="status" required>
                                <option value="ยังไม่ได้ตรวจสอบ">ยังไม่ได้ตรวจสอบ</option>
                                <option value="ตรวจสอบแล้ว">ตรวจสอบแล้ว</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label"><i class="fas fa-comment me-2"></i>ข้อความเพิ่มเติม</label>
                        <textarea class="form-control" id="additionalMessage" rows="3" placeholder="กรอกข้อความเพิ่มเติม (ถ้ามี)"></textarea>
                    </div>

                    <!-- File Upload Section -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-file-pdf me-2"></i>ไฟล์ประวัติย่อ
                                </div>
                                <div class="card-body">
                                    <div class="file-upload-area" onclick="document.getElementById('resumeFile').click()">
                                        <i class="fas fa-cloud-upload-alt fa-3x text-success mb-3"></i>
                                        <p>คลิกเพื่อเลือกไฟล์ประวัติย่อ</p>
                                        <small class="text-muted">รองรับ: PDF, DOC, DOCX, XLS, XLSX</small>
                                    </div>
                                    <input type="file" id="resumeFile" accept=".pdf,.doc,.docx,.xls,.xlsx" style="display: none;">
                                    <div id="resumePreview" class="mt-3"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-images me-2"></i>ภาพประทับใจ (สูงสุด 15 รูป)
                                </div>
                                <div class="card-body">
                                    <div class="file-upload-area" onclick="document.getElementById('imageFiles').click()">
                                        <i class="fas fa-camera fa-3x text-success mb-3"></i>
                                        <p>คลิกเพื่อเลือกภาพประทับใจ</p>
                                        <small class="text-muted">รองรับ: JPG, JPEG, PNG, PDF</small>
                                    </div>
                                    <input type="file" id="imageFiles" accept=".jpg,.jpeg,.png,.pdf" multiple style="display: none;">
                                    <div id="imagePreview" class="mt-3"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div id="uploadProgress" class="mb-3" style="display: none;">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%">0%</div>
                        </div>
                    </div>

                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-paper-plane me-2"></i>ส่งข้อมูล
                        </button>
                    </div>
                </form>
            </div>

            <!-- Tab 2: Dashboard -->
            <div class="tab-pane fade" id="dashboard" role="tabpanel">
                <!-- Statistics Cards -->
                <div class="row mb-4">
                    <div class="col-md-4 mb-3">
                        <div class="stats-card">
                            <i class="fas fa-users fa-3x mb-3"></i>
                            <div class="stats-number" id="totalUsers">0</div>
                            <p>จำนวนผู้อัปโหลด</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="stats-card">
                            <i class="fas fa-file-alt fa-3x mb-3"></i>
                            <div class="stats-number" id="totalFiles">0</div>
                            <p>จำนวนไฟล์ประวัติ</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="stats-card">
                            <i class="fas fa-images fa-3x mb-3"></i>
                            <div class="stats-number" id="totalImages">0</div>
                            <p>จำนวนภาพประทับใจ</p>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-chart-bar me-2"></i>สถิติตามโรงเรียน
                            </div>
                            <div class="card-body">
                                <canvas id="schoolChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-chart-pie me-2"></i>สถิติตามสถานะ
                            </div>
                            <div class="card-body">
                                <canvas id="statusChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" class="form-control" id="dashboardSearch" placeholder="ค้นหาข้อมูล...">
                        </div>
                    </div>
                </div>

                <!-- Recent Data Table -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-list me-2"></i>ข้อมูลล่าสุด (5 รายการ)
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped" id="recentDataTable">
                                <thead>
                                    <tr>
                                        <th>ชื่อ-สกุล</th>
                                        <th>โรงเรียน</th>
                                        <th>ภาพตัวอย่าง</th>
                                        <th>สถานะ</th>
                                        <th>วันที่ส่ง</th>
                                    </tr>
                                </thead>
                                <tbody id="recentDataBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 3: Data Management -->
            <div class="tab-pane fade" id="manage" role="tabpanel">
                <!-- Admin Password Modal -->
                <div class="modal fade" id="adminModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title"><i class="fas fa-lock me-2"></i>ยืนยันรหัสผ่านผู้ดูแล</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label class="form-label">รหัสผ่าน</label>
                                    <input type="password" class="form-control" id="adminPassword" placeholder="กรอกรหัสผ่านผู้ดูแล">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                                <button type="button" class="btn btn-primary" onclick="verifyAdmin()">ยืนยัน</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Edit Modal -->
                <div class="modal fade" id="editModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title"><i class="fas fa-edit me-2"></i>แก้ไขข้อมูล</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="editForm">
                                    <input type="hidden" id="editRowId">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">ชื่อ-สกุล</label>
                                            <input type="text" class="form-control" id="editFullName">
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">โรงเรียน</label>
                                            <select class="form-select" id="editSchool">
                                                <!-- Options will be populated -->
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">ตำแหน่ง</label>
                                            <select class="form-select" id="editPosition">
                                                <!-- Options will be populated -->
                                            </select>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">สถานะ</label>
                                            <select class="form-select" id="editStatus">
                                                <option value="ยังไม่ได้ตรวจสอบ">ยังไม่ได้ตรวจสอบ</option>
                                                <option value="ตรวจสอบแล้ว">ตรวจสอบแล้ว</option>
                                            </select>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ยกเลิก</button>
                                <button type="button" class="btn btn-primary" onclick="updateData()">บันทึก</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Management Controls -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <button class="btn btn-success me-2" onclick="refreshData()">
                            <i class="fas fa-sync me-2"></i>รีเฟรชข้อมูล
                        </button>
                        <button class="btn btn-info" onclick="printReport()">
                            <i class="fas fa-print me-2"></i>พิมพ์รายงาน
                        </button>
                    </div>
                </div>

                <!-- Data Table -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-table me-2"></i>จัดการข้อมูลทั้งหมด
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped" id="dataTable">
                                <thead>
                                    <tr>
                                        <th>ลำดับ</th>
                                        <th>วันที่</th>
                                        <th>ชื่อ-สกุล</th>
                                        <th>โรงเรียน</th>
                                        <th>ตำแหน่ง</th>
                                        <th>สถานะ</th>
                                        <th>ภาพตัวอย่าง</th>
                                        <th>จัดการ</th>
                                    </tr>
                                </thead>
                                <tbody id="dataTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.27/dist/sweetalert2.all.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <script>
        // Configuration
        const CONFIG = {
            SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbwAH2iNZ0kXB7D6deXN4Wj1IQN8C6of947iKXqBSVGB0jerv32c0mTt79V4k3pN29hP/exec',
            MAX_FILE_SIZE: 30 * 1024 * 1024, // 30MB
            MAX_IMAGES: 15,
            ADMIN_PASSWORD: 'admin1234'
        };

        // Global variables
        let allData = [];
        let dataTable;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            checkPDPAConsent();
            initializeApp();
        });

        // PDPA Functions
        function checkPDPAConsent() {
            const consent = localStorage.getItem('pdpaConsent');
            if (!consent) {
                const pdpaModal = new bootstrap.Modal(document.getElementById('pdpaModal'));
                pdpaModal.show();
            }
        }

        function acceptPDPA() {
            localStorage.setItem('pdpaConsent', 'true');
            const pdpaModal = bootstrap.Modal.getInstance(document.getElementById('pdpaModal'));
            pdpaModal.hide();
            
            Swal.fire({
                icon: 'success',
                title: 'ยินดีต้อนรับ!',
                text: 'ขอบคุณที่ยินยอมใช้งานระบบ',
                timer: 2000,
                showConfirmButton: false
            });
        }

        // Initialize application
        function initializeApp() {
            setupEventListeners();
            setDefaultDate();
            loadData();
        }

        // Set default date to today
        function setDefaultDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('submitDate').value = today;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Form submission
            document.getElementById('uploadForm').addEventListener('submit', handleFormSubmit);
            
            // File uploads
            document.getElementById('resumeFile').addEventListener('change', handleResumeUpload);
            document.getElementById('imageFiles').addEventListener('change', handleImageUpload);
            
            // Tab changes
            document.querySelectorAll('[data-bs-toggle="tab"]').forEach(tab => {
                tab.addEventListener('shown.bs.tab', function(e) {
                    if (e.target.id === 'dashboard-tab') {
                        loadDashboard();
                    } else if (e.target.id === 'manage-tab') {
                        loadManagementData();
                    }
                });
            });

            // Search functionality
            document.getElementById('dashboardSearch').addEventListener('input', filterDashboardData);
        }

        // Handle form submission
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            if (!validateForm()) return;
            
            showLoading(true);
            
            try {
                const formData = await collectFormData();
                const response = await submitData(formData);
                
                if (response.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'สำเร็จ!',
                        text: 'ส่งข้อมูลเรียบร้อยแล้ว',
                        timer: 3000,
                        showConfirmButton: false
                    });
                    
                    document.getElementById('uploadForm').reset();
                    clearPreviews();
                    setDefaultDate();
                } else {
                    throw new Error(response.message || 'เกิดข้อผิดพลาด');
                }
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'เกิดข้อผิดพลาด!',
                    text: error.message
                });
            } finally {
                showLoading(false);
            }
        }

        // Validate form
        function validateForm() {
            const requiredFields = ['submitDate', 'fullName', 'position', 'academicLevel', 'school', 'email', 'phone'];
            
            for (let field of requiredFields) {
                const element = document.getElementById(field);
                if (!element.value.trim()) {
                    Swal.fire({
                        icon: 'warning',
                        title: 'กรุณากรอกข้อมูลให้ครบถ้วน',
                        text: `กรุณากรอก${element.previousElementSibling.textContent}`
                    });
                    element.focus();
                    return false;
                }
            }

            // Validate email
            const email = document.getElementById('email').value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                Swal.fire({
                    icon: 'warning',
                    title: 'รูปแบบอีเมลไม่ถูกต้อง',
                    text: 'กรุณากรอกอีเมลให้ถูกต้อง'
                });
                return false;
            }

            // Validate phone
            const phone = document.getElementById('phone').value;
            if (!/^[0-9]{10}$/.test(phone)) {
                Swal.fire({
                    icon: 'warning',
                    title: 'รูปแบบเบอร์โทรไม่ถูกต้อง',
                    text: 'กรุณากรอกเบอร์โทร 10 หลัก'
                });
                return false;
            }

            return true;
        }

        // Collect form data
        async function collectFormData() {
            const formData = {
                submitDate: document.getElementById('submitDate').value,
                fullName: document.getElementById('fullName').value,
                position: document.getElementById('position').value,
                academicLevel: document.getElementById('academicLevel').value,
                school: document.getElementById('school').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                additionalMessage: document.getElementById('additionalMessage').value,
                status: document.getElementById('status').value,
                resumeFile: null,
                imageFiles: []
            };

            // Handle resume file
            const resumeFile = document.getElementById('resumeFile').files[0];
            if (resumeFile) {
                formData.resumeFile = {
                    name: resumeFile.name,
                    type: resumeFile.type,
                    data: await fileToBase64(resumeFile)
                };
            }

            // Handle image files
            const imageFiles = document.getElementById('imageFiles').files;
            for (let i = 0; i < imageFiles.length; i++) {
                const file = imageFiles[i];
                formData.imageFiles.push({
                    name: file.name,
                    type: file.type,
                    data: await fileToBase64(file)
                });
            }

            return formData;
        }

        // Convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }

        // Submit data to Google Apps Script
        async function submitData(formData) {
            const response = await fetch(CONFIG.SCRIPT_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain'
                },
                body: JSON.stringify({
                    action: 'submit',
                    data: formData
                })
            });

            return await response.json();
        }

        // Handle resume file upload
        function handleResumeUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (file.size > CONFIG.MAX_FILE_SIZE) {
                Swal.fire({
                    icon: 'warning',
                    title: 'ไฟล์ใหญ่เกินไป',
                    text: 'ขนาดไฟล์ต้องไม่เกิน 30MB'
                });
                e.target.value = '';
                return;
            }

            const preview = document.getElementById('resumePreview');
            preview.innerHTML = `
                <div class="alert alert-success">
                    <i class="fas fa-file-pdf me-2"></i>
                    <strong>${file.name}</strong>
                    <br>
                    <small>ขนาด: ${(file.size / 1024 / 1024).toFixed(2)} MB</small>
                </div>
            `;
        }

        // Handle image files upload
        function handleImageUpload(e) {
            const files = Array.from(e.target.files);
            
            if (files.length > CONFIG.MAX_IMAGES) {
                Swal.fire({
                    icon: 'warning',
                    title: 'จำนวนไฟล์เกินกำหนด',
                    text: `สามารถอัปโหลดได้สูงสุด ${CONFIG.MAX_IMAGES} ไฟล์`
                });
                e.target.value = '';
                return;
            }

            const totalSize = files.reduce((sum, file) => sum + file.size, 0);
            if (totalSize > CONFIG.MAX_FILE_SIZE) {
                Swal.fire({
                    icon: 'warning',
                    title: 'ขนาดไฟล์รวมใหญ่เกินไป',
                    text: 'ขนาดไฟล์รวมต้องไม่เกิน 30MB'
                });
                e.target.value = '';
                return;
            }

            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';

            files.forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'preview-image';
                        img.title = file.name;
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                } else {
                    const fileDiv = document.createElement('div');
                    fileDiv.className = 'alert alert-info d-inline-block me-2 mb-2';
                    fileDiv.innerHTML = `<i class="fas fa-file me-2"></i>${file.name}`;
                    preview.appendChild(fileDiv);
                }
            });
        }

        // Clear file previews
        function clearPreviews() {
            document.getElementById('resumePreview').innerHTML = '';
            document.getElementById('imagePreview').innerHTML = '';
        }

        // Load data from Google Sheets
        async function loadData() {
            try {
                const response = await fetch(CONFIG.SCRIPT_URL + '?action=getData');
                const result = await response.json();
                
                if (result.success) {
                    allData = result.data || [];
                    updateStatistics();
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        // Update statistics
        function updateStatistics() {
            document.getElementById('totalUsers').textContent = allData.length;
            document.getElementById('totalFiles').textContent = allData.filter(item => item.resumeFile).length;
            document.getElementById('totalImages').textContent = allData.reduce((sum, item) => sum + (item.imageCount || 0), 0);
        }

        // Load dashboard
        function loadDashboard() {
            updateStatistics();
            createCharts();
            loadRecentData();
        }

        // Create charts
        function createCharts() {
            createSchoolChart();
            createStatusChart();
        }

        // Create school chart
        function createSchoolChart() {
            const ctx = document.getElementById('schoolChart').getContext('2d');
            
            const schoolData = {};
            allData.forEach(item => {
                schoolData[item.school] = (schoolData[item.school] || 0) + 1;
            });

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(schoolData),
                    datasets: [{
                        label: 'จำนวนผู้ส่ง',
                        data: Object.values(schoolData),
                        backgroundColor: 'rgba(76, 175, 80, 0.8)',
                        borderColor: 'rgba(76, 175, 80, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Create status chart
        function createStatusChart() {
            const ctx = document.getElementById('statusChart').getContext('2d');
            
            const statusData = {};
            allData.forEach(item => {
                statusData[item.status] = (statusData[item.status] || 0) + 1;
            });

            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(statusData),
                    datasets: [{
                        data: Object.values(statusData),
                        backgroundColor: [
                            'rgba(76, 175, 80, 0.8)',
                            'rgba(255, 193, 7, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true
                }
            });
        }

        // Load recent data
        function loadRecentData() {
            const recentData = allData.slice(-5).reverse();
            const tbody = document.getElementById('recentDataBody');
            
            tbody.innerHTML = recentData.map(item => `
                <tr>
                    <td>${item.fullName}</td>
                    <td>${item.school}</td>
                    <td>
                        ${item.firstImage ? `
                        <div class="thumbnail-container">
                            <img src="${item.firstImage}" class="preview-image" style="width: 50px; height: 50px;">
                            <div class="thumbnail-overlay">${item.imageCount || 0} ภาพ</div>
                        </div>
                        ` : 'ไม่มีภาพ'}
                    </td>
                    <td>
                        <span class="badge ${item.status === 'ตรวจสอบแล้ว' ? 'bg-success' : 'bg-warning'}">${item.status}</span>
                    </td>
                    <td>${new Date(item.submitDate).toLocaleDateString('th-TH')}</td>
                </tr>
            `).join('');
        }

        // Filter dashboard data
        function filterDashboardData() {
            const searchTerm = document.getElementById('dashboardSearch').value.toLowerCase();
            const filteredData = allData.filter(item => 
                item.fullName.toLowerCase().includes(searchTerm) ||
                item.school.toLowerCase().includes(searchTerm)
            );
            
            // Update recent data table with filtered results
            const tbody = document.getElementById('recentDataBody');
            tbody.innerHTML = filteredData.slice(0, 5).map(item => `
                <tr>
                    <td>${item.fullName}</td>
                    <td>${item.school}</td>
                    <td>
                        ${item.firstImage ? `
                        <div class="thumbnail-container">
                            <img src="${item.firstImage}" class="preview-image" style="width: 50px; height: 50px;">
                            <div class="thumbnail-overlay">${item.imageCount || 0} ภาพ</div>
                        </div>
                        ` : 'ไม่มีภาพ'}
                    </td>
                    <td>
                        <span class="badge ${item.status === 'ตรวจสอบแล้ว' ? 'bg-success' : 'bg-warning'}">${item.status}</span>
                    </td>
                    <td>${new Date(item.submitDate).toLocaleDateString('th-TH')}</td>
                </tr>
            `).join('');
        }

        // Load management data
        function loadManagementData() {
            const tbody = document.getElementById('dataTableBody');
            
            tbody.innerHTML = allData.map((item, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${new Date(item.submitDate).toLocaleDateString('th-TH')}</td>
                    <td>${item.fullName}</td>
                    <td>${item.school}</td>
                    <td>${item.position}</td>
                    <td>
                        <span class="badge ${item.status === 'ตรวจสอบแล้ว' ? 'bg-success' : 'bg-warning'}">${item.status}</span>
                    </td>
                    <td>
                        ${item.firstImage ? `
                        <div class="thumbnail-container">
                            <img src="${item.firstImage}" class="preview-image" style="width: 40px; height: 40px;">
                            <div class="thumbnail-overlay">${item.imageCount || 0} ภาพ</div>
                        </div>
                        ` : 'ไม่มีภาพ'}
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary me-1" onclick="editData(${index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteData(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');

            // Initialize DataTable if not already initialized
            if ($.fn.DataTable.isDataTable('#dataTable')) {
                $('#dataTable').DataTable().destroy();
            }
            
            dataTable = $('#dataTable').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/th.json'
                },
                pageLength: 10,
                order: [[0, 'desc']]
            });
        }

        // Edit data
        function editData(index) {
            const adminModal = new bootstrap.Modal(document.getElementById('adminModal'));
            adminModal.show();
            
            // Store the index for later use
            window.editIndex = index;
            window.editAction = 'edit';
        }

        // Delete data
        function deleteData(index) {
            const adminModal = new bootstrap.Modal(document.getElementById('adminModal'));
            adminModal.show();
            
            // Store the index for later use
            window.editIndex = index;
            window.editAction = 'delete';
        }

        // Verify admin password
        function verifyAdmin() {
            const password = document.getElementById('adminPassword').value;
            
            if (password !== CONFIG.ADMIN_PASSWORD) {
                Swal.fire({
                    icon: 'error',
                    title: 'รหัสผ่านไม่ถูกต้อง',
                    text: 'กรุณากรอกรหัสผ่านให้ถูกต้อง'
                });
                return;
            }

            const adminModal = bootstrap.Modal.getInstance(document.getElementById('adminModal'));
            adminModal.hide();
            document.getElementById('adminPassword').value = '';

            if (window.editAction === 'edit') {
                showEditModal(window.editIndex);
            } else if (window.editAction === 'delete') {
                confirmDelete(window.editIndex);
            }
        }

        // Show edit modal
        function showEditModal(index) {
            const item = allData[index];
            
            document.getElementById('editRowId').value = index;
            document.getElementById('editFullName').value = item.fullName;
            document.getElementById('editSchool').value = item.school;
            document.getElementById('editPosition').value = item.position;
            document.getElementById('editStatus').value = item.status;
            
            // Populate select options
            populateEditSelects();
            
            const editModal = new bootstrap.Modal(document.getElementById('editModal'));
            editModal.show();
        }

        // Populate edit form selects
        function populateEditSelects() {
            const schoolSelect = document.getElementById('editSchool');
            const positionSelect = document.getElementById('editPosition');
            
            // Copy options from main form
            schoolSelect.innerHTML = document.getElementById('school').innerHTML;
            positionSelect.innerHTML = document.getElementById('position').innerHTML;
        }

        // Update data
        async function updateData() {
            const index = document.getElementById('editRowId').value;
            const updatedData = {
                fullName: document.getElementById('editFullName').value,
                school: document.getElementById('editSchool').value,
                position: document.getElementById('editPosition').value,
                status: document.getElementById('editStatus').value
            };

            try {
                showLoading(true);
                
                const response = await fetch(CONFIG.SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: JSON.stringify({
                        action: 'update',
                        index: parseInt(index),
                        data: updatedData
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'อัปเดตสำเร็จ!',
                        text: 'ข้อมูลได้รับการอัปเดตแล้ว',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    const editModal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
                    editModal.hide();
                    
                    await loadData();
                    loadManagementData();
                } else {
                    throw new Error(result.message || 'เกิดข้อผิดพลาด');
                }
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'เกิดข้อผิดพลาด!',
                    text: error.message
                });
            } finally {
                showLoading(false);
            }
        }

        // Confirm delete
        function confirmDelete(index) {
            const item = allData[index];
            
            Swal.fire({
                title: 'ยืนยันการลบ',
                text: `คุณต้องการลบข้อมูลของ ${item.fullName} หรือไม่?`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'ลบ',
                cancelButtonText: 'ยกเลิก'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    await performDelete(index);
                }
            });
        }

        // Perform delete
        async function performDelete(index) {
            try {
                showLoading(true);
                
                const response = await fetch(CONFIG.SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain'
                    },
                    body: JSON.stringify({
                        action: 'delete',
                        index: parseInt(index)
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'ลบสำเร็จ!',
                        text: 'ข้อมูลได้รับการลบแล้ว',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    await loadData();
                    loadManagementData();
                } else {
                    throw new Error(result.message || 'เกิดข้อผิดพลาด');
                }
            } catch (error) {
                Swal.fire({
                    icon: 'error',
                    title: 'เกิดข้อผิดพลาด!',
                    text: error.message
                });
            } finally {
                showLoading(false);
            }
        }

        // Refresh data
        async function refreshData() {
            showLoading(true);
            await loadData();
            loadManagementData();
            showLoading(false);
            
            Swal.fire({
                icon: 'success',
                title: 'รีเฟรชสำเร็จ!',
                text: 'ข้อมูลได้รับการอัปเดตแล้ว',
                timer: 2000,
                showConfirmButton: false
            });
        }

        // Print report
        function printReport() {
            const printWindow = window.open('', '_blank');
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>รายงานข้อมูลประวัติย่อและภาพประทับใจ</title>
                    <style>
                        body { font-family: 'K2D', sans-serif; }
                        table { width: 100%; border-collapse: collapse; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #4CAF50; color: white; }
                        .header { text-align: center; margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h2>รายงานข้อมูลประวัติย่อและภาพประทับใจ</h2>
                        <p>สำนักงานเขตพื้นที่การศึกษามัธยมศึกษาพะเยา</p>
                        <p>วันที่พิมพ์: ${new Date().toLocaleDateString('th-TH')}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>ลำดับ</th>
                                <th>วันที่ส่ง</th>
                                <th>ชื่อ-สกุล</th>
                                <th>โรงเรียน</th>
                                <th>ตำแหน่ง</th>
                                <th>สถานะ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${allData.map((item, index) => `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${new Date(item.submitDate).toLocaleDateString('th-TH')}</td>
                                    <td>${item.fullName}</td>
                                    <td>${item.school}</td>
                                    <td>${item.position}</td>
                                    <td>${item.status}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }

        // Show/hide loading overlay
        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = show ? 'flex' : 'none';
        }
    </script>
</body>
</html>
